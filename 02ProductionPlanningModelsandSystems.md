# 2 Production Planning Models and Systems  

**Motivation**

对第一章问题的研究过程中，我们注意到在计划排产的模型和软件中有一些需要注意的问题：

- 计划排产需要改进现有系统中的缺陷（GW案例中清洗耗时没有被考虑）
- 计划排产需要与其他系统协作，以考虑更多的决策因素和更长远的决策视野，像是之前提到的MRP, ERP, MPS
- 计划排产需要与决策系统更好的集成，保证计划的可行性，从而减少人工重排的工作

为了能更好的建立模型，需要建模者更好的理解正在使用的计划系统：系统存在的限制、系统的风格和结构、系统的决策因素等。这也是本章节的动机所在

**Objective**

为了能更好的建模，建模者需要对现有的计划模型、系统有足够的认知，能够评价现有的的系统，在此基础上才能改进计划、协调系统和继承解决方案。本章的主要目标就是提供这些基础的背景知识，具体来说包括

- 介绍大部分公司使用的计划系统
- 学习计划排产的一般原则
- 学习在这些计划系统中的常见问题类型的分类

我们还分析了这些系统中的部分模型和方法的缺陷，以帮助读者选择更好的指标来评估自己的模型表现，判断优化模型是否能够改进生产效率和灵活性。

**Contents**

- 2.1 介绍一些在ERP和MRP系统中的计划软件采用的一些数学方法。
- 2.2 详细分析著名的MRP系统的计划和求解过程，包括
  + 介绍模型输入和数据结构
  + 演示构成大多数MRP系统基础的单项分解规划启发式算法
  + 分析MRP分解算法的缺陷
- 2.3 讨论APS（Advanced Planning Systems）系统具体包含的范围，其中包括生产、计划和控制系统；材料需求管理（Material Requirements Planning, MRP-I）；生产资源管理(Manufacturing Resources Planning, MRP-2)；分级生产计划（Hierarchical Production Planning, HPP）等
- 2.4 介绍采购、生产和分销计划的更多示例，来说明供应链中的计划任务和计划过程，其中没有数学模型或公式，更多是战略网络设计和供应链总体计划

## 2.1 一些计划生产模型

本章会进一步提供计划生产问题中的混整模型案例，建模的描述会与标准的ERP和MRP系统一致，下一章介绍这些系统的全部结构。

### 模型元素

首先是在大多数计划生产问题中都会包括的一些模型元素。生产计划主要任务是确定**生产批次**，确切的说是**批次大小**和**生产时间**，从而满足一定的有限范围内的**需求**（计划范围）。需求通常来自make-to-stock的预测或客户的订单，或者两者的综合。

为了定义生产计划中的可行性和经济性，还需要考虑一些特征：**资源的可用性**（机器工时、劳动力等），**生产费用**和**仓储费用**，当然还会包括其他绩效指标。

这些生产计划中最简单的模型被称为单产品的批次大小模型（single-item uncapacitated lot-sizing model LS-U)，它被用来解决对单个产品的动态需求的生产问题。它包含上述所有的模型元素，除了没有资源限制。例如[1.1 自行车生产的案例](1.1 自行车生产的案例)

当然，也会有一些只在特定问题中出现的元素，这些元素往往会使模型更加复杂，求解更加困难。

- 不同产品之间会竞争公用的资源，例如在[1.2]()的案例中公用的搅拌机器。这是一类MPS（Master Production Schedule）问题的代表，将在之后讨论。MPS方法常被用于对最终成品的计划排产。
- 产品会有多个层级，或者说，一些产品使另一些产品的生产材料，产品之间也需要考虑供应的平衡约束。这类问题被称为MRP（Material Requirements Planning）问题
- 额外元素甚至会重新定义模型和问题，例如产品运输能力有限的情况下，需求侧可能会允许产品积压甚至超过截至线
- 有些情况下，需要对模型的产能利用率有更精确的描述来保证计划的灵活性。一台机器在不同产品间切换，需要考虑有顺序限制条件的准备时间、启动时间、切换时间，就像第1章节中的搅拌机器。但是，有些情况机器的这些限制条件过于复杂无法求解，这种情况下，简化限制只考虑时间消耗也是有价值的。

###　LS-U无容量限制的批次问题

首个问题使单一产品单一层级的无容量限制的批次问题，这是所有计划排查的核心子问题，因为它会在每一个产品的生产过程中不断重复。

定义索引$t, 1 \leq t \leq n$来表示范围内离散的时间段，目标就是确定每个时间段内生产的批次大小，使其在满足需求的条件下，最小化生产和仓储成本。

在该问题中，生产成本通常由固定成本和随生产规模变化的变动成本构成，仓储成本随仓储量变化，需求必须被满足不可延期，无需考虑产能限制。

每个时间段内，有四个参数$p_t, q_t, h_t, d_t$分别表示固定生产成本，单位生产成本，单位存储成本和产品需求量。有三个变量$x_t, y_t,s_t$，分别表示生产量，生产状态（二元变量）和结束的库存量。

**Objective**
$$
\text{min} \quad \sum_{t=1}^n(p_tx_t+q_ty_t+h_ts_t)
$$
**Subject to**
$$
s_{t-1} +x_t = d_t+s_t,\quad \text{for all }t
$$

$$
s_0 = s_n = 0
$$

$$
x_t \leq M_ty_t
$$

$$
x\in \mathbb{R}_+^n, s\in \mathbb{R}_+^{n+1},y\in \{0,1\}^n 
$$

$M_t$表示剩余时间内的所有需求量，作为$x_t$的上限

### MPS主产品排产问题

第二类模型是多个产品，单个层级有限产能的批次排产问题。这类模型会同时生产多种产品，对每种产品来说，都是一个LS-U问题。但是会受限于多种产品共用的资源。例如，1.2的GW公司的排产问题。

同样，定义索引$t, 1 \leq t \leq n$来表示范围内离散的时间段，定义索引$i, 1 \leq i \leq m$来表示不同的产品，索引$k,1\leq k\leq K$表示需要的资源，参数$p_{i,t}, q_{i,t}, h_{i,t,} d_{i,t}$分别表示固定生产成本，单位生产成本，单位存储成本和产品需求量。变量$x_{i,t}, y_{i,t},s_{i,t}$，分别表示生产量，生产状态（二元变量）和结束的库存量。

定义参数$L_{k, t}$表示在时间段$t$内，资源$k$的可用容量。参数$\alpha_{i,k},\beta_{i,k}$表示产品$i$对资源$k$的单位消耗和固定消耗。

MPS问题的一般模型表示如下

**Objective**
$$
\text{min}\quad \sum_i\sum_t(p_{i,t}x_{i,t}+q_{i,t}y_{i,t}+h_{i,t}s_{i,t})
$$
**Subject to**
$$
s_{i,t-1} +x_{i,t} = d_{i,t}+s_{i,t},\quad \text{for all }i,t
$$

$$
x_{i,t} \leq M_{i,t}y_{i,t}
$$

$$
\sum_i\alpha_{i,k}x_{i,t} + \sum_i\beta_{i,k}y_{i,t}\leq L_{k,t},\quad \text{for all }k,t
$$

$$
s_{i,0} = s_{n,0}=0
$$

$$
x\in\mathbb{R}_+^{m,n},s\in \mathbb{R}_+^{m,n+1},y\in\{0,1\}^{m,n}
$$

### MRP原料需求排产问题

最后是，多产品多层次有限产能的批次排产问题。这类问题中，所有最终产品可以看作一个MPS问题，每个中间产品可以看作LS-U问题。这类问题的优化重点是协调各个层级产品的生产顺序，实现原料、中间产品和最终产品的同步生产。产品之间的依赖关系，又被称为BOM（bill of materials），其结构可以被分为连续生产模式，装配生产模式和一般模式，如下图所示

![image-20201229104122446](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20201229135923572.png)

仍然需要定义同样的索引、参数和变量。对于MRP问题，为了表示生产的层级关系还需要定义一组额外的索引$j,1\leq j\leq m$表示不同的产品，以及一个复合索引$j\in D_i$表示产品$i$的直接消耗者，例如$D_1={2,3}$表示产品2和3需要消耗产品1作为原料。所有的最终产品都有$D_i=\empty$。对$j\in D_i$，定义参数$r_{i,j}$表示生产单位产品$j$需要消耗的产品$i$的数量。定义参数$\gamma_i$表示产品$i$的交货期，对于在$t$时间生产的产品$x_{i,t}$在$t+\gamma_i$时刻完成交货。MRP模型表示如下

**Objective**
$$
\text{min}\quad\sum_i\sum_t(p_{i,t}x_{i,t}+q_{i,t}y_{i,t}+h_{i,t}s_{i,t}) \label{12}
$$
**Subject to**
$$
s_{i, t-1}+x_{i,t-\gamma_i}=(d_{i,t}+\sum_{j\in D_i}r_{i,j}x_{j,t})+s_{i,t}
$$

$$
x_{i,t}\leq M_{i,t}y_{i,t}
$$

$$
\sum_i\alpha_{i,k}x_{i,t}+\sum_i\beta_{i,k}y_{i,t}\leq L_{k,t}
$$

$$
s_{i,0}=s_{i,n} =0
$$

$$
x\in \mathbb{R}_+^{m,n},s\in\mathbb{R}_+^{m,n+1},y\in{0,1}^{m,n} \label{17}
$$

由于产品层级的问题，LS-U子模型在其中表现的不明显。我们会在第4部分介绍如何重构LS-U模型来连接产能和生产结构的限制。这种重构模型又被称为梯形存储模型，可以将多层级问题转换为一个单层级问题，我们在之后的问题中会做更深入的学习。

## 2.2 MRP模型

在[2.1](##MRP原料需求排产问题)我们已经完成了一个基本的MRP模型，其中包括由BOM结构表示的产品层级关系，已经可以满足基础的生产计划需求。为了能更精确的描述实际过程，许多扩展因素也需要被考虑到模型当中，包括超时、产品或者组分的替代品、替代路线或者机器的选择性、站点之间的运输、部分组件的购买或者外包、生产率和产能等等。不过基础的MRP模型仍然是大多问题的核心，大部分MRP和ERP计划系统仍然使用基础模型，甚至是基于LS-U的分解模型寻求可行的计划。

本节，我们将使用专业的操作管理术语介绍一般MRP模型和它的输入，同时还会介绍传统的启发式的MRP分解方法并讨论它的缺陷。

> *我们会在此类格式中介绍MRP模型属于与公式$\ref{12}-\ref{17}$之间的联系*

### 2.2.1 计划模型和它的输入

**在计划范围内的独立需求**

独立需求是计划生产需要达到的主要目标。工厂的需求除了来自用户对最终产品的需求，也会由来自供应链系统中其他厂区的部分需求。

> *参数$d_{i,t}$表示独立需求*

在MTS（make-to-stock）系统中，产品独立需求必须要在需要的时候已经入库，因此需要对需求进行预测才能制定计划。这种生产常被用于产品种类少数量多的标准产品行业中，例如快速消费品。

在MTO（make-to-order）或者ATO（assemble-to-order）系统中，产品在订单生成之后安排生产，在一定时间内完成交货。因此，此类工厂需要由足够的原料或中间零件的库存，减少生产时间之外的其他准备时间。MTO问题可以被分解为如图所示的两个单独问题。上游阶段，决定原料的准备和半成品的生产计划，类似与MTS问题。下游阶段，根据用户订单决定半成品的装配生产成品的计划。MTS生产计划常被用于使用少数原材料或者中间零件生产大量种类产品的行业。MTS尽管需要增加中间零件的库存费用，但是更利于满足成品的交货时间，典型的案例为生产PC的Dell。

![image-20201229133645559](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20201230093328711.png)

对于所有生产政策，计划排产的时间范围至少要满足累计交货时间的要求，包括采购、生产和交货时间，这我们需要从一开始就要将原料的供应纳入到最终产品的交付当中考虑。通常来说，计划排产会随时间窗滚动，早期的计划方案，会随着时间的进行更新需求和数据，并生成新的计划。

**利用BOM计算独立需求**

BOM是不同产品的层级结构关系，我们可以根据BOM计算最终产品对中间零件需求和必要交货时间。

![image-20201229135923572](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20201229104122446.png)

图中为一个简单案例

- FP由零件A和C组装
- A需要2B和3C生产
- B和C是原材料

在该案例中，生产FP需要原料4C和2B，直接零件1A1C

> *$r_{i,j}, j\in D_i $指直接零件*

在这里，中间零件的需求量（A, C）实际上由生产者决定，只有FP完全由客户订单决定，因此对FP的需求才是**独立需求**，而对中间零件A和C的需求是为了满足独立需求产生的非独立需求。独立需求与非独立需求的区别，将会贯穿整个MRP问题的始终。

> *对于非独立需求，可以用$\sum_{j \in D_i}(r_{i,j}x_{j,t})$*

**采购和生产的交货时间**

采购和生产并不是一瞬间完成，为了让模型更贴近实际，采购和生产过程中的必要的时间也需要在模型中考虑。当交货时间很短时，可以将其合并在采购和生产的总时间一起表示，如图2.4中使用LT来表示整个零件的准备、安排、等待、生产、质检和运输的全部时间。在传统MRP计划中，这些交货时间通常都是固定的，不会随着时间或者订单大小改变。

> *$\gamma_i $表示中间零件的交货时间，为了满足最终产品的交货时间，排产的时间周期至少应当大于在BOM路径上的最长交货时间*

需要注意的是，我们在优化模型中使用的$\gamma_i$与MRP计划过程中的生产交货时间有一些重要的区别。在优化模型中，$\gamma_i$实际上是产品$i$最小的交货时间，最小意味着没有任何和的机器或者资源的等待时间，因为资源和产能的约束已经在模型中考虑，因此不需要考虑冗余时间。

而传统的MRP不能直接处理产能限制问题，因此生产交货时间总会导致排产人员陷入糟糕境地。为了满足需求，需要在$\gamma_i$之上增加一部分安全时间作为冗余，这在很多时间是多余的。

**组件工序**

为了更好的描述生产过程，在BOM图之上，还可以对中间零件生成的工序进行刻画

![image-20201229150056116](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20201229133645559.png)

如图，零件A的生产工序是一个最简单的顺序工艺，共有切割、组装和喷漆三个步骤，每一步骤都有对应的时间和资源消耗。通常，这里还会考虑中间的运输耗时。

![image-20201229150154226](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20201229150056116.png)

> *生产工序的耗时可以近似的表示为$\alpha_{i,k},\beta_{i,k}$ 更详细的工序耗时表示，可以进行更深入的优化*

**资源限制**

资源限制通常表示为一台机器在一个时间周期内可以运行的时间

> *资源限制使用$L_k$表示*

**库存记录**

当前产品的库存状态可能包括一下组成

- 在库的产品，指在仓库内的实体产品
- 为后续订单预留的库存量
- 超时或延期订单的库存量
- 未入库的库存，指已经生产或采购完成当尚未入库的产品库存

$$
可用库存 = 在库量-预留库存量
$$

$$
库存水平 =未入库量-超市库存量
$$

**计划规则**

MRP软件的计划规则包括：

- 预留安全库存量
- 预留安全时间
- 单个产品的批次生产规则和需要的组分
- 单个批次内各组分的参数

### 2.2.2 计划程序：单个产品分解

我们已经获得了MRP软件需要的所有输入条件，但是问题在于如何设计一个求解模型的方法。这样的模型一般规模较大，有许多因素制约以至于难以求解：

- 模型的时间段需要很短才能满足需求和产能的精确利用
- 计划时间需要很长才能满足全球的供应和生产管理
- 重要资源的利用率需要一直跟踪
- 所有中间零件都需要被建模

因此，一般采用一些分解方法来将问题简化为若干子问题，并逐步求解。

#### 成品生产计划MPS

MPS是对最终成品的计划，在MPS计划中我们只关心关系到成品产率的最后一步。MPS通常都是为了应对短期大量的订单而制定，需要对需求进行预测，并按预测需求生产入库，在订单生成时直接从库存发货。生产计划除了满足预测需求，也需要保持安全库存量，以防止预测出现偏差。

![image-20201230093328711](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20201229150154226.png)

![image-20201230094451326](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20201230094451326.png)

Table 2.3的数据和Figure2.4的BOM可以视为一个典型的MPS问题，在该案例中：

- 毛需求（Gross requirements）指确定的客户需求和预测需求的最大值
- 第6个时间段的结束库存，相当于额外的预测需求量
- 净需求（Net requirements）是满足总需求所需，或者相当于预测库存达到安全库存所需的最小额外生产数量。
- 预计库存（Projected inventory）等于 开始库存+入库量（scheduled receipts）+MPS计划完成订单(MPS planned order end)-净需求
- MPS订单开始到结束需要一个时间段的交货时间（Lead time =1）
- 可保证产品（Available to promise）等于 开始库存+入库量+计划完成订单-坚定用户需求-安全库存，ATP表示可以满足的最大需求水平

通过Table2.3我们可以逐月进行计划安排和库存评估，完成 一个以最小库存水平为目标的计划方案。我们也可以选择生产和库存的费用最小为目标，这些仍然在单个产品单个层级的排产问题范畴内。

#### 粗剪产能规划 （Rough Cut  Capacity Planning, RCCP）

上述方法可用于单独计划甚至优化每个成品的 MPS。然而，这类成品通常共享一些关键的稀缺资源，需要对不同的MPS计划进行一些整合。这与 MPS 流程并行执行，称为RCCP。它的作用是在全球范围内或"大致"检查MPS在容量利用率方面的可行性。 在最简单的情况下，建立 MPS 时不考虑标准限制，使用RCCP根据MPS计划计算关键资源的近似负载。如果负载超过容量，规划人员必须调整 MPS 或手动增加容量。 在更复杂的系统中，系统建议对 MPS 进行整合和修改或增加容量。 这种方法仍然是近似的或粗略的，因为此产能规划过程不考虑最后一个阶段意外的生产阶段，包括各个阶段的当前库存和在现行订单，好像净需求等于所有阶段的毛需求，以及不同生产阶段生产 MPS 消耗的组件所需的生产订单的规模和时间。因此，只有还需要知道所有组件的详细生产计划，才能执行详细的有限产能验证步骤。

#### 最终装配计划（Final Assembly Scheduling , FAS）

在装配到订单（assemble-to-order）的生产政策中，会使用一种类似于MPS的政策。ATO政策中会使用中间零件来将订单过程解耦，根据预测需求来生产零件并完成入库，根据订单需求来将零件完成组装，对于零件来说就是一个MPS计划的MTS生产过程。在完成零件生产之后，FAS在根据订单需求，从库存获得零件并完成成品组装。

![image-20201230104449896](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20201230104449896.png)

####  物料需求计划 （Material Requirements Planning, MRP)

MRP一般会使用和RCCP相似的方法，通过近似方法来预估原材料和组分的需求量，并安排计划。但是，一旦MPS计划被制定完成，其需要的组件消耗量和时间也会被确定，利用这些已被安排的信息，我们减少MRP安排中的不确定因素，从而减少不必要的原材料库存。通常来说，需要根据MPS计算各个组件的生产计划，再根据组件的生产计划计算组件的组件的计划，不断迭代最终得到物料需求计划MRP。

![image-20201230110449293](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20201231094311333.png)

图中显示了根据BOM来确定MRP的过程，FP的需求由预测确定，A的需求由FP的需求确定，原材料B的需求由A确定，原材料C的需求由FP和A共同确定。

BOM中的每一个元素都需要按照一定顺序进行MRP计算，计算过程大致如下

1. 计算毛需求

   毛需求分为独立需求和非独立需求，非独立需求来自与BOM图中的直接下级。

2. 计算净需求

   净需求为毛需求除去预期到货

3. 利用批次计划规则进行排产，得到的结果作为建议采购清单

在MRP系统中，批次采购规则一般分为，刚好满足需求（lot for lot， LFL，原料刚好满足需求，库存最小），定量采购（economic order quantity, EOQ, 每次采购同样数量），定期采购（period order quantity, POQ， 固定采购周期），或者一些动态规则，部分周期平衡（part period balancing, PBB），最小单位成本（least unit cost, LUC）,最小周期成本（least period cost, LPC）。

![image-20201231094311333](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20201231104026398.png)

Table 2.4 为一个简单的原料C的采购计划示意

- 对于原料C来说，并不存在独立的需求
- 原料C的非独立的需求来自FP和A的订单，1单位A需要3单位C，1单位FP需要1单位C（见BOM图）
- 初始库存可以满足前3个周期，因此第4个周期才出现净需求
- 采购计划使用的是EOQ规则，每次采购130

MRP会对所有的原料按照上述例子的方式，独立的进行采购计划，并定期更新。但是MRP在排产使使用的使LS-U方法，这也意味着无法考虑到一些容量限制，尤其是多种原料的混合性质。因此，MRP的原材料采购清单只是作为建议，还需要人工审核和确认。

#### 产能需求计划（Capacity Requirements Planning, CRP）

上述所有的过程都是独立进行的，但是有些计划之间需要协同考虑，例如MPS和RCCP。在MRP系统中被成为产能需求计划，目的是检验在产能有限的情况下计划是否可行

例如对于一个RCCP计划，CRP会根据MRP计划计算详细的资源消耗，他会把该订单时间范围内所有的订单都考虑其中，然后检验每一个资源是否超出了其容量上限。如果没有超过，那么建议计划会被审核通过成为确定计划。如果校验不通过，需要人工进行处理。CRP可以定位到产能限制，但是并不能解决问题。

在一些系统中，CRP可以自动的提升产能或者调整订单顺序，但是这些方法都是启发式的，一般都是在无限制的计划基础上推迟计划或者提高产能来实现。

### 2.2.3 MRP系统的局限

尽管MRP系统已经使一个将生产管理和信息系统结合的强大工具，但是它采用的短视的分解方法一直被认为是非常有局限的。

![image-20201231104026398](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20201230110449293.png)

例如在上图案例中，产品有2级，产品1需要产品2作为原料进行生产。a表示所有可能的路径图，b为MRP的到的解决方案，因为MRP方案会先产品1进行计划，然后根据产品1的计划得到产品2的需求，最后再生成产品2的计划。c为一个优化的方案。

除了经济性的缺陷，在MRP系统中，生产计划被简单的分解成一个个无约束的单产品排产问题，从成品到原料依次完成求解。耦合的约束或者产能限制，只能在全部求解完成之后进行，排产人员只能祈祷计划可行，否则必须要耗费大量精力进行人工调整。

## 2.3 高级排产系统（Advanced Planning Systems, APS）

### 2.3.1 供应链计划（Supply Chain Planning）

供应链通常是一系列在法律上独立的组织，通过物料、信息和财务流连接，最终完成面向终端用户的价值成品或者服务。供应链的实体也可能是同一个大公司中在不同地区的部门。在供应链中，需要完成原料采购和加工，成品的生产、分销。

因此，供应链通常被建模为由供应商节点组成的网络，包括生产或转化产品的工厂节点； 接收，存储和分发产品的分发中心节点； 产品销售或消费的市场节点； 连接节点并支持物理和信息流运输的边。

供应链计划是一种管理供应链活动的集成的计划方法。它的范围包括基础的活动，采购、制造、仓储、运输等，也可能包括一些附加的活动。它还涉及一些各个活动跨时间的集成，也被称为分级集成，包括战略问题、战术问题或者操作层面的集成。战略问题基于聚合数据管理长期的生产和资源获取的计划变更。战术问题使用汇总信息来分析中期计划范围内的资源分配和利用问题。这包括制定有关物料流，库存，产能利用率和维护计划的决策。操作问题旨在计划和控制生产任务的执行。例如，生产排序和输入/输出分析模型就属于此类。这种集成对于成功至关重要，否则公司无法在有关其技术或工厂和设施的布局的战略决策不力的情况下，保持运营和地位的竞争性。最后，供应链的集成还包括这些活动的空间上的集成。

得益于IT技术的发展，针对供应链各个单个过程的系统，被逐渐开发和集成到一个复杂的供应链管理环境当中。如图是一个制造资源管理（MRP-II）系统在制造计划和控制（Manufacturing Planning and Control, MPC）的案例。中期总体计划和MPS计划决策产能的利用率和总体库存，以以满足中期预测需求。通常中期计划的时间范围为一年，还会包含季节性的需求变化。短期的MPS计划在终端产品的层面上，计划当期的产能利用和库存水平，以满足具体的产品预测需求。短期计划通常是数周。MRP-I系统会根据MPS计划发布短期计划内所有组件（原料、零件、成品）的生产计划。接着车间控制系统（shop floor control system, 组件生产）和供应商跟进系统(vendor control system, 组件采购)按照MRP-I的计划，进行近期内的计划执行，通常考虑只有数天内的计划。有些MRP-II系统还会在MRP-I系统后，集成分级的生产计划（Hierarchical Production Planning, HPP），适用于一些更加通用的生产系统中。

![image-20210104103622599](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20210104103622599.png)

但是传统MPC系统的集成，仍然是数据的集成，不具有对系统的分析功能，也不能帮助在系统层面的优化。

### 2.3.2 高级计划系统和供应链计划矩阵

在传统的ERP数据集成的基础上，建立的具有系统分析和优化的系统，也即高级计划系统（Advanced Planning Systems, APS）。APS会的结构包括的元素被称为供应链计划矩阵（Supply Chain Planning Matrix, SCPM），如下图所示。

![image-20210104131821190](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20210104131821190.png)

APS的主要特征如下：

- 整体计划或全球计划：协调整个供应链的计划；
- 优化重点：确定计划任务的替代方案、目标和约束； 
- 分层方法：分解为计划模块，并通过信息流对其进行纵向和横向协调。

图2.11展示了这些在传统的ERP和MRP系统中并不具备的特征。在传统系统中存在约束限制，当不能进行优化。对于多个计划时，往往采用次序或者独立方法来处理。

![image-20210104133918207](https://gitee.com/behe-moth/picgo_img/raw/master/pic/image-20210104133918207.png)

APS中各系统与SCPM的关系如上图。

## 2.4 一些供应链计划的问题

本节简略的不含公式的介绍两类供应链计划的问题类型

### 2.4.1 战略网络问题

**决策**

战略网络问题主要决策点供应链中的各个节点和边的状态。对于节点，需要决策是否需要新增工厂，生产规模；对于边，需要决策是否启用，使用何种运输方式和运输量。这种决策可能并不是静态的，会随着时间周期或者季节发生变化。

**约束**

决策需要满足预测需求，因此主要约束是产品流在各个节点各个时间周期的约束限制。还有产能限制约束。

**目标**

优化目标通常是在满足预测需求的前提下，最大化年入税后收入。

**模型类型**

通常来说都是MILP问题

**挑战**

模型规模大，产品层级复杂

### 2.4.2 供应链总体计划问题

供应链总体规划问题的目的是在中期范围内优化和同步整个供应链中的物料流。 主要目的是在考虑瓶颈资源的能力的同时，集中考虑所有相关成本和约束条件，使供需水平适应合计产品的需求。 这种全球供应链中期决策的观点使人们可以通过改善协调和消除供应链实体之间的冗余缓冲区来降低库存水平。

这个问题中供应链网络的设计被更高层次，更长远的计划模块所固定。 总体规划的结果对较低级别的详细规划模块施加限制，这些模块通常在功能上分解为短期采购，生产，分配和运输模块。 为了协调这三个计划级别，还须实施反馈机制。

**决策**

主要决策是所有供应链实体的总体生产和分销计划。 特别是，确定每个产品组，每个时间段和位置（工厂或仓库）的生产数量。 同样，为供应链网络中的每个环节，每个产品组和每个时间段确定运输量。

这些问题始终是动态的，多周期的问题，因为它们的主要目的是优化随着时间的推移，加工水平的变化与库存水平的变化之间的权衡，以便使满足所有产品的全球供应链需求的成本降至最低 。 一段时间内的库存水平是生产和运输决策的结果。

与战略网络设计问题相比，总体计划的主要区别是决策模型的详细程度。 总体计划的计划周期的长度较短，通过中间产品和可存储产品来对更详细的产品组进行建模，并对生产和存储设施进行更详细的建模。 例如，，在对产能利用率有重大影响时机器的开机时间和转换时间，都被纳入总体规划中。 详细程度需要满足供应，生产和分配过程的灵活性。 为了促进与短期计划的协调，通常会使用较小的时间间隔对中期范围内的短期范围（前几天或几周）进行建模。

**约束**

主要的约束仍然是产品流约束，以及产能和仓储限制。

**目标**

优化目标通常是权衡仓储费用、生产费用和运输费用后的最小总费用。

**模型类型**

模型类型通常是MILP问题